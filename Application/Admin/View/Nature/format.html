<extend name="Public/base"/>
<block name="body">
	<!-- 标题栏 -->
	<div class="main-title">
		<h2>{$meta_title}</h2>
	</div>
	<div class="cf">
		<form class="layui-form layui-form-pane" id="search_form" action="{:u('format',array('id'=>$id))}">
			<div class="layui-form-item" style="margin-bottom:0px">
				<div class="layui-inline">
					<button type="button" class="layui-btn layui-btn-normal" url="{:u('formatadd',array('id'=>$id))}" id="add">添加规格</button>
				</div>
			</div>

			<div class="search-form fr cf">
				<div class="layui-inline">
					<label class="layui-form-label">所属类型</label>
					<div class="layui-input-inline">
						<select name="id" lay-search="">
							<if condition="($id eq 0)">
								<option value="0">请选择</option>
							</if>
							<volist name="types" id="val">
								<option value="{$val.id}" <if condition="($id eq $val['id'])">selected</if>>{$val.name}</option>
							</volist>
						</select>
					</div>
					<button class="layui-btn layui-btn-primary layui-btn-sm" style="height:38px;"  lay-submit="" id="search" lay-filter="search"><i class="layui-icon">&#xe615;</i></button>
				</div>
			</div>


		</form>
	</div>
	<div class="page">
		{$page}
	</div>
	<!-- 数据列表 -->
	<div class="data-table">
		<div class="data-table table-striped">
			<table>
				<!-- 表头 -->
				<thead>
				<tr>
					<th style="text-align: center;" class="row-selected">
						<input class="checkbox check-all" type="checkbox" style="width:17px;height:17px;margin-top: 10px">
					</th>
					<th style="text-align: center;">编号</th>
					<th style="text-align: center">排序</th>
					<th style="text-align: center;">规格名称</th>
					<th style="text-align: center">参数列表</th>
					<th style="text-align: center">操作</th>
				</tr>
				</thead>
				<!-- 列表 -->
				<tbody>
				<notempty name="list">
					<volist name="list" id="val" key="key">
						<tr style="height:100px">
							<td align="center" width="100">
								<input class="ids row-selected" type="checkbox" name="ids" value="{$val.id}" style="width:17px;height:17px">
							</td>
							<td align="center" width="100">
								{$val.id}
							</td>
							<td align="center" width="100">
								<input type="text" name="sort" class="text input-mini sort" style="width:40px;" value="{$val.sort}" ovalue="{$val.sort}" data-id="{$val.id}">
							</td>
							<td align="center" width="200">
								{$val.name}
							</td>
							<td align="center" width="400">
								<volist name="val['param']" id="v">
									<span style="padding-left: 10px;color: blue">{$v.name}</span>
								</volist>
							</td>
							</td>
							<td align="center" width="160">
								<i class="layui-icon" style="cursor: pointer;font-size: 20px;" name="edit" url="{:u('formatedit',array('id'=>$id,'format_id'=>$val['id']))}" title="编辑">&#xe642;</i>
								<i class="layui-icon" style="cursor: pointer;font-size: 20px;" name="delete" url="{:u('formatedel',array('ids'=>$val['id']))}" title="删除">&#xe640;</i>
							</td>
						</tr>
					</volist>
					<else/>
					<td colspan="16" class="text-center">aOh! 暂时还没有内容!</td>
				</notempty>
				</tbody>
			</table>
		</div>
	</div>
	<div class="page">
		{$page}
	</div>
</block>
<block name="script">
	<script type="text/javascript">
        $(function () {
            var id = {$id};
            layui.use(['form', 'layer'], function () {
                var layer = layui.layer;
                var form = layui.form
                form.on('submit(search)', function (data) {
                    var url = "{:U('format')}";
                    var query = $("#search_form").serialize();
                    query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g, '');
                    query = query.replace(/^&/g, '');
                    if (url.indexOf('?') > 0) {
                        url += '&' + query;
                    } else {
                        url += '?' + query;
                    }

                    window.location.href = url;
                    return false;
                });

                //表单初始赋值
                form.val('example', {

                })
            });
            //添加
            $("#add").click(function(){
                var url = $(this).attr("url");
				if(id == 0){
                    layer.msg("请选择所属类型",{icon:5,time:1000});
                    return false;
				}
                window.location.href = url;
            });
            //编辑
            $("[name='edit']").click(function(){
                var url = $(this).attr("url");
                window.location.href = url;
            });
            //删除
            $("[name='delete']").click(function(){
                var url = $(this).attr("url");
                var msg = "确定要删除当前规格吗?";
                layer.confirm(msg,{icon:3,title:"删除规格",move:false},function(index){
                    var index = layer.msg('加载中...', {icon: 16,time:0,shade:[0.3,'#000']});
                    $.get(url,function(data){
                        if(data.status){
                            layer.closeAll();
                            layer.msg(data.info,{icon:6},function(){
                                location.reload(true);
                            });
                        }else{
                            layer.msg(data.info,{icon:5});
                        }
                        layer.close(index);
                    }, 'json');
                });
            });
            //排序
            $(".sort").focus(function(){
                if($(this).val() == "0"){
                    $(this).val("");
                }
            }).blur(function(){
                var self = $(this);
                var ovalue = $(this).attr('ovalue');
                var value = $(this).val();
                if(value == "" && ovalue != value){
                    $(this).val("0");
                }else{
                    if(ovalue != value){
                        $.get('{:U("setSort")}',{id:$(this).attr('data-id'),sort:value}, function(data) {
                            if(data.status == "1"){
                                layer.closeAll();
                                layer.msg(data.info,{icon:6,time:1000},function(){
                                    location.reload(true);
                                });
                            }else{
                                layer.tips(data.info,self, {
                                    tips: [1]
                                });
                                self.val(ovalue);
                            }
                        });
                    }
                }
            });
        })
        //导航高亮
        highlight_subnav("{:U('format')}");
	</script>
</block>
